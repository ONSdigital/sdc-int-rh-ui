{% extends 'base-' + display_region + '.html' %}

{% from 'components/access-code/_macro.njk' import onsUACInput %}
{% from 'components/button/_macro.njk' import onsButton %}
{% from "components/input/_macro.njk" import onsInput %}

{% from "components/breadcrumbs/_macro.njk" import onsBreadcrumbs %}
{% from "components/collapsible/_macro.njk" import onsCollapsible %}
{% from "components/panel/_macro.njk" import onsPanel %}

{% set messages_dict=dict(get_flashed_messages()|groupby('level')) %}
{% set field_messages_dict=dict(messages_dict['ERROR']|groupby('field')) %}

{% set form =  {
    'method': 'POST',
    'attributes': {
        'action': url('Start:post', display_region=display_region)
    }
} %}

{%- if 'uac_empty' in field_messages_dict -%}
    {%- set error_uac = {'id': 'uac_empty', 'text': _('Enter an access code')} -%}
{%- elif 'uac_invalid' in field_messages_dict -%}
    {%- set error_uac = {'id': 'uac_invalid', 'text': _('Enter a valid access code')} -%}
{%- endif -%}

{% if display_region == 'cy' %}
    {% set breadcrumb_items = [
                {
                    "url": domain_url_cy,
                    "text": 'Hafan'
                }
            ]
    %}
    {%- set where_code_link = domain_url_cy + '/ble-i-ddod-o-hyd-ich-cod-mynediad/' -%}
{% else %}
    {% set breadcrumb_items = [
                {
                    "url": domain_url_en,
                    "text": 'Home'
                }
            ]
    %}
    {%- set where_code_link = domain_url_en + '/where-to-find-your-access-code/' -%}
{% endif %}

{% block preMain %}
    {{
        onsBreadcrumbs({
            "ariaLabel": 'Breadcrumb',
            "itemsList": breadcrumb_items
        })
    }}
{% endblock %}

{% block main %}

    {% if messages_dict %}
        {% include 'partials/messages.html' with context %}
    {% endif %}

    <h1 class="ons-u-fs-xxl ons-u-mt-l">{{_('Start study')}}</h1>

    {{
        onsUACInput({
            'id': 'uac',
            'name': 'uac',
            'postTextboxLinkText': _('Where to find your access code'),
            'postTextboxLinkUrl': where_code_link,
            'label': {
                'text': _('Enter your 16-character access code'),
                'description': _('Keep this code safe. You will need to enter it every time you access your study')
            },
            'securityMessage': _('Your personal information is protected by law and will be kept confidential.'),
            'error': error_uac
        })
    }}

    {{ onsButton({
        'id': 'submitUACBtn',
        'text': _('Access survey'),
        'classes': 'ons-u-mb-xl',
        'name': 'action[save_continue]',
        'submitType': 'loader'
    }) }}


{% endblock %}
