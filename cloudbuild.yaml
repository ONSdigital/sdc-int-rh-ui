steps:
  - name: python:3.6-buster
    id: Python Env Setup And App Tests
    entrypoint: bash
    dir: /workspace
    timeout: '1200s'
    args:
    - -c
    - |
      echo "Loading Pattern Library Templates"
      ./scripts/load_templates.sh
      echo "Pip Install"
      pip install pipenv
      pipenv install --dev --deploy
      echo "Run Tests"
      pipenv run pytest tests/unit --cov=app --cov-report xml --ignore=node_modules

  # Docker Build
  - name: 'gcr.io/cloud-builders/docker'
    id: Docker Build
    args: [ 'build', '-t', 'europe-west2-docker.pkg.dev/ons-ci-int/int-docker-snapshot/rh-ui:$BRANCH_NAME', '-f', 'Dockerfile', '.' ]
      
images: [ 'europe-west2-docker.pkg.dev/ons-ci-int/int-docker-snapshot/rh-ui:$BRANCH_NAME' ]




